<?xml version="1.0" encoding="utf-8"?><!DOCTYPE nta PUBLIC '-//Uppaal Team//DTD Flat System 1.1//EN' 'http://www.it.uu.se/research/group/darts/uppaal/flat-1_1.dtd'><nta><declaration>// Place global declarations here.
const int N = 6; //amount of voters
const int candidates = 2; //amount of candidates
int lastcoercedvoterid, voters_vote, coercion, coercion_report;

chan ballot, vote, vote_end, notify_auth, coerce[N], tracker[N], faketracker[N];</declaration><template><name x="5" y="5">Voter</name><parameter>const int me</parameter><declaration>// Place local declarations here.
bool coerced = false;</declaration><location id="id0" x="-96" y="224"><name x="-80" y="208">received_fake_tracker</name></location><location id="id1" x="-96" y="136"><name x="-216" y="128">received_tracker</name></location><location id="id2" x="16" y="-40"><name x="32" y="-48">notified_auth_of_coertion</name></location><location id="id3" x="-96" y="48"><name x="-152" y="32">voted</name></location><location id="id4" x="-96" y="-112"><name x="-208" y="-120">received_ballot</name></location><location id="id5" x="-96" y="-208"><name x="-112" y="-240">start</name></location><init ref="id5"/><transition><source ref="id2"/><target ref="id3"/><label kind="select" x="-16" y="-8">i: int[0, candidates-1]</label><label kind="synchronisation" x="-16" y="8">vote!</label><label kind="assignment" x="-16" y="24">voters_vote = i</label></transition><transition><source ref="id4"/><target ref="id2"/><label kind="guard" x="-24" y="-128">coerced == true</label><label kind="synchronisation" x="-24" y="-112">notify_auth!</label><label kind="assignment" x="-24" y="-96">lastcoercedvoterid = me</label></transition><transition><source ref="id1"/><target ref="id0"/><label kind="guard" x="-200" y="160">coerced == true</label><label kind="synchronisation" x="-208" y="176">faketracker[me]?</label></transition><transition><source ref="id3"/><target ref="id1"/><label kind="synchronisation" x="-184" y="80">tracker[me]?</label></transition><transition><source ref="id4"/><target ref="id3"/><label kind="select" x="-224" y="-80">i: int[0, candidates-1]</label><label kind="guard" x="-200" y="-64">coerced == false</label><label kind="synchronisation" x="-128" y="-48">vote!</label><label kind="assignment" x="-192" y="-32">voters_vote = i</label></transition><transition><source ref="id5"/><target ref="id4"/><label kind="synchronisation" x="-144" y="-184">ballot?</label></transition><transition><source ref="id5"/><target ref="id5"/><label kind="guard" x="-40" y="-240">coerced == false</label><label kind="synchronisation" x="-40" y="-224">coerce[me]?</label><label kind="assignment" x="-40" y="-208">coerced = true</label><nail x="-48" y="-232"/><nail x="-48" y="-192"/></transition></template><template><name>Authority</name><declaration>int voted = N-1;
int tally[candidates];

void vote_update(){
	voted++;
	tally[voters_vote]++;
}</declaration><location id="id6" x="0" y="-16"><name x="-88" y="-40">after_voting</name></location><location id="id7" x="0" y="176"><name x="-168" y="160">after_publishing_tally</name></location><location id="id8" x="0" y="80"><name x="-160" y="56">after_publishing_votes</name></location><location id="id9" x="0" y="-112"><name x="-120" y="-144">voting_execution</name></location><location id="id10" x="0" y="-208"><name x="-128" y="-232">voting_preparation</name></location><init ref="id10"/><transition><source ref="id6"/><target ref="id8"/></transition><transition><source ref="id9"/><target ref="id6"/><label kind="guard" x="-80" y="-80">voted == N</label><label kind="synchronisation" x="-72" y="-64">vote_end!</label></transition><transition><source ref="id10"/><target ref="id10"/><label kind="guard" x="72" y="-232">voted &gt; 0</label><label kind="synchronisation" x="72" y="-216">ballot!</label><label kind="assignment" x="72" y="-200">voted--</label><nail x="64" y="-224"/><nail x="64" y="-192"/></transition><transition><source ref="id8"/><target ref="id7"/><label kind="guard" x="-80" y="112">voted == 0</label></transition><transition><source ref="id8"/><target ref="id8"/><label kind="guard" x="64" y="56">voted &gt; 0</label><label kind="synchronisation" x="64" y="72">tracker[voted-1]!</label><label kind="assignment" x="64" y="88">voted--</label><nail x="56" y="64"/><nail x="56" y="96"/></transition><transition><source ref="id9"/><target ref="id9"/><label kind="synchronisation" x="72" y="-128">vote?</label><label kind="assignment" x="72" y="-112">vote_update()</label><nail x="64" y="-128"/><nail x="64" y="-96"/></transition><transition><source ref="id10"/><target ref="id9"/><label kind="guard" x="-80" y="-184">voted == 0</label><label kind="synchronisation" x="-48" y="-168">ballot!</label></transition></template><template><name>Coercer</name><declaration>int c;</declaration><location id="id11" x="-16" y="16"><name x="-88" y="0">coercing</name></location><location id="id12" x="-16" y="-80"><name x="-120" y="-96">before_voting</name></location><init ref="id12"/><transition><source ref="id12"/><target ref="id11"/><label kind="select" x="-152" y="-56">i: int[0, candidates-1]</label><label kind="assignment" x="-48" y="-32">c = i</label></transition><transition><source ref="id11"/><target ref="id11"/><label kind="select" x="40" y="0">i : int[0, N-1]</label><label kind="synchronisation" x="40" y="16">coerce[i]!</label><nail x="32" y="0"/><nail x="32" y="32"/></transition></template><template><name>Defense_System</name><declaration>int coerced = 0;
int coerced_table[N];

void updatecoercion(){
	coerced++;
	coerced_table[coerced-1] = lastcoercedvoterid;
}</declaration><location id="id13" x="-16" y="144"><name x="-80" y="120">finished</name></location><location id="id14" x="-16" y="48"><name x="-192" y="32">fake_tracker_processing</name></location><location id="id15" x="-16" y="-48"><name x="-232" y="-64">coercion_notification_gathering</name></location><init ref="id15"/><transition><source ref="id14"/><target ref="id14"/><label kind="guard" x="48" y="24">coerced &gt; 0</label><label kind="synchronisation" x="48" y="40">faketracker[coerced_table[coerced-1]]!</label><label kind="assignment" x="48" y="56">coerced--</label><nail x="40" y="24"/><nail x="40" y="72"/></transition><transition><source ref="id15"/><target ref="id15"/><label kind="synchronisation" x="48" y="-72">notify_auth?</label><label kind="assignment" x="48" y="-56">updatecoercion()</label><nail x="40" y="-72"/><nail x="40" y="-24"/></transition><transition><source ref="id14"/><target ref="id13"/><label kind="guard" x="-104" y="80">coerced == 0</label></transition><transition><source ref="id15"/><target ref="id14"/><label kind="synchronisation" x="-76" y="-15">vote_end?</label></transition></template><system>// Place template instantiations here.
Auth = Authority();
C = Coercer();
DS = Defense_System();

V0 = Voter(0);
V1 = Voter(1);
V2 = Voter(2);
V3 = Voter(3);
V4 = Voter(4);
V5 = Voter(5);

// List one or more processes to be composed into a system.
system Auth, DS, C, V0, V1, V2, V3, V4, V5;</system></nta>